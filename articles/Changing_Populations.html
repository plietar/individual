<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Changing population • individual</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Changing population">
<meta property="og:description" content="individual">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">individual</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/API.html">API</a>
    </li>
    <li>
      <a href="../articles/Changing_Populations.html">Changing population</a>
    </li>
    <li>
      <a href="../articles/Checkpoint.html">Saving and restoring simulation state</a>
    </li>
    <li>
      <a href="../articles/Contributing.html">Contributing</a>
    </li>
    <li>
      <a href="../articles/Performance.html">Performance</a>
    </li>
    <li>
      <a href="../articles/Tutorial.html">Tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/individual/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Changing population</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/individual/blob/HEAD/vignettes/Changing_Populations.Rmd" class="external-link"><code>vignettes/Changing_Populations.Rmd</code></a></small>
      <div class="hidden name"><code>Changing_Populations.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This tutorial will present a toy model for simulating infectious
disease in populations which change in size. We will build on the SIR
model we created in the <a href="Tutorial.html">first tutorial</a> to
show how to model a growing and shrinking population.</p>
</div>
<div class="section level2">
<h2 id="resizing-variables">Resizing variables<a class="anchor" aria-label="anchor" href="#resizing-variables"></a>
</h2>
<p>As of individual v0.1.8, all variables and targeted events can be
extended and shrunk. Extending a variable requires the user to specify
new values to add to the end of the variable. This can be used to model
births in a population. Shrinking a variable requires the user to
specify which indices to remove, the indices of subsequent values will
be shifted downwards to replace the removed element. This can be used to
model deaths or displacement from a population.</p>
<p>Targeted events can similarly be resized to match a changing
population. You can simply add new individuals with
<code>$queue_extend</code>. If you would like to schedule the event for
new individuals, you can use <code>$queue_extend_with_schedule</code>
with a vector of delays to make sure the event is triggered for new
individuals.</p>
<p>Resizing updates, shrinking and extending, are queued until after all
processes <em>and</em> event listeners are executed and are applied
after other updates. All the shrink updates for a variable or event are
combined and are applied before extend updates. This ensures that the
indices used to shrink a variable are the correct size for the variable.
After which, extension updates are applied in the order they were
called.</p>
<p>From a performance perspective, shrinking updates should be used
sparingly, since the re-indexing of a variable can be more
computationally expensive than other updates. Consider applying
shrinking updates over longer intervals instead of every time step if
performance becomes an issue for your model.</p>
</div>
<div class="section level2">
<h2 id="birth-and-death-processes">Birth and death processes<a class="anchor" aria-label="anchor" href="#birth-and-death-processes"></a>
</h2>
<p>Let’s try to model a system with a constant birth rate and the
probability of death each time step is uniform for each individual.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">birth_rate</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">death_rate</span> <span class="op">&lt;-</span> <span class="fl">.001</span></span>
<span></span>
<span><span class="va">birth_process</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_births</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">birth_rate</span> <span class="op">/</span> <span class="va">dt</span><span class="op">)</span></span>
<span>  <span class="va">health</span><span class="op">$</span><span class="fu">queue_extend</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'S'</span>, <span class="va">n_births</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">recovery_event</span><span class="op">$</span><span class="fu">queue_extend</span><span class="op">(</span><span class="va">n_births</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">death_process</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pop_size</span> <span class="op">&lt;-</span> <span class="va">health</span><span class="op">$</span><span class="fu">size</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">pop_size</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">pop_size</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">death_rate</span> <span class="op">/</span> <span class="va">dt</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">health</span><span class="op">$</span><span class="fu">queue_shrink</span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span></span>
<span>  <span class="va">recovery_event</span><span class="op">$</span><span class="fu">queue_shrink</span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h2>
<p>We can now add these processes to our previous model and plot the new
results.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/simulation_loop.html">simulation_loop</a></span><span class="op">(</span></span>
<span>  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span>,</span>
<span>  events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">recovery_event</span><span class="op">)</span>,</span>
<span>  processes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">infection_process</span>,</span>
<span>    <span class="va">recovery_process</span>,</span>
<span>    <span class="va">birth_process</span>, <span class="co"># new process to introduce S into the population</span></span>
<span>    <span class="va">death_process</span>, <span class="co"># new process to randomly remove individuals from the populations</span></span>
<span>    <span class="va">health_render_process</span></span>
<span>  <span class="op">)</span>,</span>
<span>  timesteps <span class="op">=</span> <span class="va">steps</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Changing_Populations_files/figure-html/unnamed-chunk-5-1.png" width="1800"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Giovanni Charles, Sean L. Wu, Peter Winskill, Paul Liétar.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
