<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Saving and restoring simulation state • individual</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Saving and restoring simulation state">
<meta property="og:description" content="individual">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">individual</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/API.html">API</a>
    </li>
    <li>
      <a href="../articles/Changing_Populations.html">Changing population</a>
    </li>
    <li>
      <a href="../articles/Checkpoint.html">Saving and restoring simulation state</a>
    </li>
    <li>
      <a href="../articles/Contributing.html">Contributing</a>
    </li>
    <li>
      <a href="../articles/Performance.html">Performance</a>
    </li>
    <li>
      <a href="../articles/Tutorial.html">Tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/individual/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Saving and restoring simulation state</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/individual/blob/HEAD/vignettes/Checkpoint.Rmd" class="external-link"><code>vignettes/Checkpoint.Rmd</code></a></small>
      <div class="hidden name"><code>Checkpoint.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="intro">Introduction<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p>When modeling the impact of an intervention on a disease, it is
common to have a first simulation phase where the intervention is
disabled to achieve steady-state, followed by a second phase during
which the intervention is applied. Often, we want to run the second
phase many times over, varying the intervention parameters. Simulating
the first phase every time is unnecessary and wasteful, since it isn’t
affected by the intervention parameters.</p>
<p>Individual allows the user to run a simulation for a number of time
steps, save the state of the simulation and resume it multiple times,
with different parameters each time. This way, the initial phase before
the intervention only needs to be simulated once.</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The typical way to use this feature is to define a simulation
function which creates all the relevant simulation data and then calls
<code>simulation_loop</code>. The function we define takes in an
optional <code>state</code> parameter that is passed through to
<code>simulation_loop</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_simulation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">timesteps</span>, <span class="va">state</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">health</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CategoricalVariable.html">CategoricalVariable</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">process</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bernoulli_process.html">bernoulli_process</a></span><span class="op">(</span><span class="va">health</span>, <span class="st">"S"</span>, <span class="st">"I"</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/simulation_loop.html">simulation_loop</a></span><span class="op">(</span></span>
<span>    variables<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">health</span><span class="op">)</span>,</span>
<span>    processes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">process</span><span class="op">)</span>,</span>
<span>    timesteps<span class="op">=</span><span class="va">timesteps</span>,</span>
<span>    state<span class="op">=</span><span class="va">state</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The simulation can be run a first time, for a given number of steps.
It returns a <em>state object</em>, which captures the internal state of
all variables and events, the state of the random number generator and
the number of time steps that were simulated.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>timesteps <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p>Finally, the simulation is resumed with a larger number of time
steps, passing in the state object as an argument. The
<code>timesteps</code> argument refers to the total number of time
steps, including both the original simulation run and the new one. In
this case, <code>run_simulation</code> will only simulate 50 extra
steps. Before running the actual simulation,
<code>simulation_loop</code> will reload the simulation state from its
argument, overwriting any values we had set when initializing the
variables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">run_simulation</span><span class="op">(</span>timesteps <span class="op">=</span> <span class="fl">100</span>, state<span class="op">=</span><span class="va">state</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Practical example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>To demonstrate the checkpoint and restore functionality of individual
in a practical setting, we will use a SIRS model with a vaccination
intervention. Our aim is to compare the impact of the vaccination
campaign, given different vaccine efficacy scenarios.</p>
<p>Individuals in the simulation move from being susceptible (S) to
infectious (I) to recovered (R) and back to susceptible, after their
natural immunity wanes off. Out of the entire population <code>N</code>,
only <code>I0</code> individuals are initially infectios, and the rest
are susceptible. Orthogonally, an individual can either be vaccinated
(Y) or not (N). The vaccination and the immunity it confers never wanes
off. All individuals are initially unvaccinated.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_variables</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span>, <span class="va">I0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">health_states_t0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"S"</span>,<span class="va">N</span><span class="op">)</span></span>
<span>  <span class="va">health_states_t0</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>,size <span class="op">=</span> <span class="va">I0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"I"</span></span>
<span>  <span class="va">health</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CategoricalVariable.html">CategoricalVariable</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>,<span class="st">"I"</span>,<span class="st">"R"</span><span class="op">)</span>, initial_values <span class="op">=</span> <span class="va">health_states_t0</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">vaccinated</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/CategoricalVariable.html">CategoricalVariable</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="st">"N"</span><span class="op">)</span>, initial_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>health<span class="op">=</span><span class="va">health</span>, vaccinated<span class="op">=</span><span class="va">vaccinated</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A vaccinated individual has a reduced probability of becoming
infectious, as determined by the vaccine’s efficacy. The function below
creates the process to model infection. It samples from the susceptible
compartments, applying the different rates depending on the whether an
individual’s vaccinated status.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_infection_process</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">health</span>, <span class="va">vaccinated</span>, <span class="va">N</span>, <span class="va">beta</span>, <span class="va">vaccine_efficacy</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">I</span> <span class="op">&lt;-</span> <span class="va">health</span><span class="op">$</span><span class="fu">get_size_of</span><span class="op">(</span><span class="st">"I"</span><span class="op">)</span></span>
<span>    <span class="va">foi</span> <span class="op">&lt;-</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">I</span> <span class="op">/</span> <span class="va">N</span></span>
<span></span>
<span>    <span class="va">vaccinated_S</span> <span class="op">&lt;-</span> <span class="va">health</span><span class="op">$</span><span class="fu">get_index_of</span><span class="op">(</span><span class="st">"S"</span><span class="op">)</span><span class="op">$</span><span class="fu">and</span><span class="op">(</span><span class="va">vaccinated</span><span class="op">$</span><span class="fu">get_index_of</span><span class="op">(</span><span class="st">"Y"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">non_vaccinated_S</span> <span class="op">&lt;-</span> <span class="va">health</span><span class="op">$</span><span class="fu">get_index_of</span><span class="op">(</span><span class="st">"S"</span><span class="op">)</span><span class="op">$</span><span class="fu">and</span><span class="op">(</span><span class="va">vaccinated</span><span class="op">$</span><span class="fu">get_index_of</span><span class="op">(</span><span class="st">"N"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">vaccinated_S</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>rate <span class="op">=</span> <span class="va">foi</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">vaccine_efficacy</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">non_vaccinated_S</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>rate <span class="op">=</span> <span class="va">foi</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">health</span><span class="op">$</span><span class="fu">queue_update</span><span class="op">(</span>value <span class="op">=</span> <span class="st">"I"</span>, index <span class="op">=</span> <span class="va">vaccinated_S</span><span class="op">)</span></span>
<span>    <span class="va">health</span><span class="op">$</span><span class="fu">queue_update</span><span class="op">(</span>value <span class="op">=</span> <span class="st">"I"</span>, index <span class="op">=</span> <span class="va">non_vaccinated_S</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For a while at the start of the simulation no vaccination takes
place. Only after a number of time steps, determined by the
<code>vaccination_start</code> parameter, does the intervention begin.
Periodically, an event will fire and every individual has a fixed
probability of becoming vaccinated. If <code>vaccination_start</code> is
<code>NULL</code>, the intervention never begins.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_vaccination_event</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vaccinated</span>, <span class="va">vaccination_start</span>, <span class="va">vaccination_interval</span>, <span class="va">vaccination_rate</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">e</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Event.html">Event</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">e</span><span class="op">$</span><span class="fu">add_listener</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">vaccinated</span><span class="op">$</span><span class="fu">queue_update</span><span class="op">(</span>value <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>      <span class="va">vaccinated</span><span class="op">$</span><span class="fu">get_index_of</span><span class="op">(</span><span class="st">"N"</span><span class="op">)</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span><span class="va">vaccination_rate</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">e</span><span class="op">$</span><span class="fu">schedule</span><span class="op">(</span><span class="va">vaccination_interval</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">vaccination_start</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">e</span><span class="op">$</span><span class="fu">schedule</span><span class="op">(</span><span class="va">vaccination_start</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">e</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We will define our simulation as a function, taking the simulation
parameters as arguments. Any additional arguments to the function, as
denoted by <code>...</code>, will be passed on to
<code>simulation_loop</code>. This will allow us to pass the
<code>state</code> argument in. The function returns the simulation data
as well as the new saved state.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_simulation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">steps</span>,</span>
<span>    <span class="va">N</span> <span class="op">=</span> <span class="fl">1e3</span>,</span>
<span>    <span class="va">I0</span> <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    <span class="va">beta</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="co"># S -&gt; I</span></span>
<span>    <span class="va">gamma</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="co"># I -&gt; R</span></span>
<span>    <span class="va">xi</span> <span class="op">=</span> <span class="fl">0.03</span>, <span class="co"># R -&gt; S</span></span>
<span>    <span class="va">vaccination_start</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="va">vaccination_interval</span> <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    <span class="va">vaccination_rate</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="co"># N -&gt; Y</span></span>
<span>    <span class="va">vaccine_efficacy</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu">make_variables</span><span class="op">(</span><span class="va">N</span>, <span class="va">I0</span><span class="op">)</span></span>
<span>  <span class="va">infection_process</span> <span class="op">&lt;-</span> <span class="fu">make_infection_process</span><span class="op">(</span></span>
<span>    <span class="va">variables</span><span class="op">$</span><span class="va">health</span>,</span>
<span>    <span class="va">variables</span><span class="op">$</span><span class="va">vaccinated</span>,</span>
<span>    <span class="va">N</span>, <span class="va">beta</span>, <span class="va">vaccine_efficacy</span><span class="op">)</span></span>
<span>  <span class="va">recovery_process</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bernoulli_process.html">bernoulli_process</a></span><span class="op">(</span><span class="va">variables</span><span class="op">$</span><span class="va">health</span>, <span class="st">"I"</span>, <span class="st">"R"</span>, <span class="va">gamma</span><span class="op">)</span></span>
<span>  <span class="va">return_process</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bernoulli_process.html">bernoulli_process</a></span><span class="op">(</span><span class="va">variables</span><span class="op">$</span><span class="va">health</span>, <span class="st">"R"</span>, <span class="st">"S"</span>, <span class="va">xi</span><span class="op">)</span></span>
<span>  <span class="va">vaccination_event</span> <span class="op">&lt;-</span> <span class="fu">make_vaccination_event</span><span class="op">(</span></span>
<span>    <span class="va">variables</span><span class="op">$</span><span class="va">vaccinated</span>, <span class="va">vaccination_start</span>, <span class="va">vaccination_interval</span>, <span class="va">vaccination_rate</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">renderer</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Render.html">Render</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>timesteps <span class="op">=</span> <span class="va">steps</span><span class="op">)</span></span>
<span>  <span class="va">health_render_process</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/categorical_count_renderer_process.html">categorical_count_renderer_process</a></span><span class="op">(</span></span>
<span>    renderer <span class="op">=</span> <span class="va">renderer</span>,</span>
<span>    variable <span class="op">=</span> <span class="va">variables</span><span class="op">$</span><span class="va">health</span>,</span>
<span>    categories <span class="op">=</span> <span class="va">variables</span><span class="op">$</span><span class="va">health</span><span class="op">$</span><span class="fu">get_categories</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">processes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">infection_process</span>,</span>
<span>    <span class="va">recovery_process</span>,</span>
<span>    <span class="va">return_process</span>,</span>
<span>    <span class="va">health_render_process</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">final_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulation_loop.html">simulation_loop</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>    events <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">vaccination_event</span><span class="op">)</span>,</span>
<span>    processes <span class="op">=</span> <span class="va">processes</span>,</span>
<span>    timesteps <span class="op">=</span> <span class="va">steps</span>,</span>
<span>    <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>result<span class="op">=</span><span class="va">renderer</span><span class="op">$</span><span class="fu">to_dataframe</span><span class="op">(</span><span class="op">)</span>, state<span class="op">=</span><span class="va">final_state</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We will start by running and plotting our baseline simulation, with
the intervention disabled.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps<span class="op">=</span><span class="fl">1500</span><span class="op">)</span><span class="op">$</span><span class="va">result</span></span>
<span><span class="va">colours</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"royalblue3"</span>,<span class="st">"firebrick3"</span>,<span class="st">"darkorchid3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span></span>
<span>  x<span class="op">=</span><span class="va">data</span><span class="op">[</span><span class="st">"timestep"</span><span class="op">]</span>,</span>
<span>  y<span class="op">=</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_count"</span>,<span class="st">"I_count"</span>, <span class="st">"R_count"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  xlab<span class="op">=</span><span class="st">"Time"</span>, ylab<span class="op">=</span><span class="st">"Count"</span>,</span>
<span>  type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">colours</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span></span>
<span>   x <span class="op">=</span> <span class="st">"topright"</span>,</span>
<span>   pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>   col <span class="op">=</span> <span class="va">colours</span>,</span>
<span>   legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>   bg<span class="op">=</span><span class="st">'white'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Checkpoint_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>We see that the simulation takes some time to settle from its initial
parameters to its steady-state conditions. We will now enable the
vaccine intervention, but only starting at a point after the simulation
has settled, for example at <code>t=500</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps<span class="op">=</span><span class="fl">1500</span>, vaccination_start <span class="op">=</span> <span class="fl">500</span>, vaccine_efficacy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">result</span></span>
<span><span class="va">colours</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"royalblue3"</span>,<span class="st">"firebrick3"</span>,<span class="st">"darkorchid3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span></span>
<span>  x<span class="op">=</span><span class="va">data</span><span class="op">[</span><span class="st">"timestep"</span><span class="op">]</span>,</span>
<span>  y<span class="op">=</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_count"</span>,<span class="st">"I_count"</span>, <span class="st">"R_count"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  xlab<span class="op">=</span><span class="st">"Time"</span>, ylab<span class="op">=</span><span class="st">"Count"</span>,</span>
<span>  type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">colours</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span></span>
<span>   x <span class="op">=</span> <span class="st">"topright"</span>,</span>
<span>   pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>   col <span class="op">=</span> <span class="va">colours</span>,</span>
<span>   legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>   bg<span class="op">=</span><span class="st">'white'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Checkpoint_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>The simulation above clearly shows the effect of the vaccination
campaign, starting at <code>t=500</code>. However, it made the
optimistic assumption of a 100% vaccine efficacy. We wish to run the
simulation again but with varying levels of efficacy, in order the
compare its impact.</p>
<p>While we could run the code above many times over, each simulation
would repeat the first 499 timesteps, despite the result being identical
each time. Instead we start by running only these timesteps, and saving
the result. We do need to specify the start of the intervention, as it
is necessary to schedule the first vaccination event. However the
details of the intervention (ie. <code>vaccine_efficacy</code>) are
irrelevant and can be omitted.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps<span class="op">=</span><span class="fl">499</span>, vaccination_start <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p>From this initial result, we can resume the simulation, but using
different values of vaccine efficacy each time. We also include a
control simulation, in which no vaccination takes place. Each of these
simulation will skip the first 499 steps and only run the next 1001 time
steps.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control</span>    <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps<span class="op">=</span><span class="fl">1500</span>, vaccination_start <span class="op">=</span> <span class="fl">500</span>, vaccine_efficacy<span class="op">=</span><span class="fl">0.0</span>, state<span class="op">=</span><span class="va">initial</span><span class="op">$</span><span class="va">state</span><span class="op">)</span></span>
<span><span class="va">vaccine30</span>  <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps<span class="op">=</span><span class="fl">1500</span>, vaccination_start <span class="op">=</span> <span class="fl">500</span>, vaccine_efficacy<span class="op">=</span><span class="fl">0.3</span>, state<span class="op">=</span><span class="va">initial</span><span class="op">$</span><span class="va">state</span><span class="op">)</span></span>
<span><span class="va">vaccine50</span>  <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps<span class="op">=</span><span class="fl">1500</span>, vaccination_start <span class="op">=</span> <span class="fl">500</span>, vaccine_efficacy<span class="op">=</span><span class="fl">0.5</span>, state<span class="op">=</span><span class="va">initial</span><span class="op">$</span><span class="va">state</span><span class="op">)</span></span>
<span><span class="va">vaccine100</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps<span class="op">=</span><span class="fl">1500</span>, vaccination_start <span class="op">=</span> <span class="fl">500</span>, vaccine_efficacy<span class="op">=</span><span class="fl">1.0</span>, state<span class="op">=</span><span class="va">initial</span><span class="op">$</span><span class="va">state</span><span class="op">)</span></span></code></pre></div>
<p>Finally we aggregate and plot the results from all these simulations.
We also need to include the data from our initial run, which we will
plot the same colour as our control simulation.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colours</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"royalblue3"</span>,<span class="st">"firebrick3"</span>,<span class="st">"darkorchid3"</span>, <span class="st">"seagreen3"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pad initial out to ensure it has the same shape as other series.</span></span>
<span><span class="va">initial</span><span class="op">$</span><span class="va">result</span><span class="op">[</span><span class="fl">500</span><span class="op">:</span><span class="fl">1500</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">initial</span><span class="op">$</span><span class="va">result</span><span class="op">[</span>,<span class="st">"I_count"</span><span class="op">]</span>,</span>
<span>    <span class="va">vaccine30</span><span class="op">$</span><span class="va">result</span><span class="op">[</span>,<span class="st">"I_count"</span><span class="op">]</span>,</span>
<span>    <span class="va">vaccine50</span><span class="op">$</span><span class="va">result</span><span class="op">[</span>,<span class="st">"I_count"</span><span class="op">]</span>,</span>
<span>    <span class="va">vaccine100</span><span class="op">$</span><span class="va">result</span><span class="op">[</span>,<span class="st">"I_count"</span><span class="op">]</span>,</span>
<span>    <span class="va">control</span><span class="op">$</span><span class="va">result</span><span class="op">[</span>,<span class="st">"I_count"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Infected count"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">colours</span>,</span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span></span>
<span>   x <span class="op">=</span> <span class="st">"topright"</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">16</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>   col <span class="op">=</span> <span class="va">colours</span>,</span>
<span>   legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"30%"</span>, <span class="st">"50%"</span>, <span class="st">"100%"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>   bg<span class="op">=</span><span class="st">'white'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Checkpoint_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="caveats">Caveats<a class="anchor" aria-label="anchor" href="#caveats"></a>
</h2>
<p>Saving and restoring the simulation state comes with a number of
caveats.</p>
<ul>
<li>All simulation state must be represented as objects managed by
individual. Any state maintained externally will not be saved nor
restored.</li>
<li>The state object’s structure is not stable and is expected to
change. One should not expect to serialize the state to disk and have it
work with future versions of the individual package.</li>
<li>The simulation must be re-created in an identical way. Variables and
events may not be added or removed, variable sizes must remain constant,
the list of categories in a <code>CategoricalVariable</code> cannot be
modified, etc. The order of variables and events passed to the
<code>run_simulation</code> function must remain stable.</li>
<li>If an event is scheduled before the checkpoint, the time at which it
will execute cannot be changed when resuming, even if that time is in
the future. For example in the SIRS model above, we would not be able to
resume the simulation with different values for
<code>vaccination_start</code>; changing that parameter would have no
effect.</li>
</ul>
<p>While parameters of the simulation can be changed between the initial
run and the subsequent runs (as demonstrated with the
<code>vaccine_efficacy</code> parameter above), in general you should
not modify parameters that would have been already had an impact on the
first part of the simulation. Doing so would produce results that can
only be produced through checkpoint and resume, and not as a single
simulation.</p>
<p>For example, in our SIRS model, it may be tempting to model a
time-varying parameter by running half of the simulation with one value
and then resuming it with a different value. While this would probably
work, it would be brittle and hard to compose. As more time-varying
parameters are introduced to the model, the simulation would need to be
saved and restored each time a value changes.</p>
<div class="section level3">
<h3 id="rng">Restoring random number generator state<a class="anchor" aria-label="anchor" href="#rng"></a>
</h3>
<p>By default resuming a simulation does not restore R’s random number
generator’s state. Every resumed run from the same saved state will be
independent and, if the model is stochastic, will produce different
results.</p>
<p>We can demonstrate that by running the baseline of our SIRS model
multiple times and plotting the results. All three runs start off from
the same state, inherited from our original model run, but quickly
diverge based on the outcome of random draws.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps<span class="op">=</span><span class="fl">499</span><span class="op">)</span></span>
<span><span class="va">run1</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps <span class="op">=</span> <span class="fl">1500</span>, state <span class="op">=</span> <span class="va">initial</span><span class="op">$</span><span class="va">state</span><span class="op">)</span></span>
<span><span class="va">run2</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps <span class="op">=</span> <span class="fl">1500</span>, state <span class="op">=</span> <span class="va">initial</span><span class="op">$</span><span class="va">state</span><span class="op">)</span></span>
<span><span class="va">run3</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps <span class="op">=</span> <span class="fl">1500</span>, state <span class="op">=</span> <span class="va">initial</span><span class="op">$</span><span class="va">state</span><span class="op">)</span></span>
<span></span>
<span><span class="va">initial</span><span class="op">$</span><span class="va">result</span><span class="op">[</span><span class="fl">500</span><span class="op">:</span><span class="fl">1500</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="va">initial</span><span class="op">$</span><span class="va">result</span><span class="op">[</span>,<span class="st">"I_count"</span><span class="op">]</span>,</span>
<span>    <span class="va">run1</span><span class="op">$</span><span class="va">result</span><span class="op">[</span>,<span class="st">"I_count"</span><span class="op">]</span>,</span>
<span>    <span class="va">run2</span><span class="op">$</span><span class="va">result</span><span class="op">[</span>,<span class="st">"I_count"</span><span class="op">]</span>,</span>
<span>    <span class="va">run3</span><span class="op">$</span><span class="va">result</span><span class="op">[</span>,<span class="st">"I_count"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Infected count"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="va">colours</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Checkpoint_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Sometimes this behaviour may not be desirable, and we would instead
like to restore the state of the random number generator exactly where
it was when we stopped the first part of the run. One example of this is
when checking that our model behaves the same whether or not it was
saved and resumed.</p>
<p>The code below show an attempt at running the model twice, once as a
continous run and once in a piecewise manner. We would hope that seeding
the random generator at the start of the simulation would be enough to
get identical results out of it. Unfortunately we don’t, because the
random number generator state’s at the intermediate point isn’t being
preserved.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">uninterrupted_run</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span><span class="op">$</span><span class="va">result</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">piecewise_run_initial</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps <span class="op">=</span> <span class="fl">499</span><span class="op">)</span></span>
<span><span class="va">piecewise_run_final</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps <span class="op">=</span> <span class="fl">1500</span>, state <span class="op">=</span> <span class="va">piecewise_run_initial</span><span class="op">$</span><span class="va">state</span><span class="op">)</span></span>
<span><span class="va">piecewise_run</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">piecewise_run_initial</span><span class="op">$</span><span class="va">result</span>, <span class="va">piecewise_run_final</span><span class="op">$</span><span class="va">result</span><span class="op">[</span><span class="fl">500</span><span class="op">:</span><span class="fl">1500</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">uninterrupted_run</span>, <span class="va">piecewise_run</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Component \"S_count\": Mean relative difference: 0.02780224"</span></span>
<span><span class="co">#&gt; [2] "Component \"I_count\": Mean relative difference: 0.127305"  </span></span>
<span><span class="co">#&gt; [3] "Component \"R_count\": Mean relative difference: 0.1365375"</span></span></code></pre></div>
<p>We can try the same again, but this time set
<code>restore_random_state = TRUE</code> to enable restoring the
simulation state. This time we’ve successfully managed to reproduce the
data from our uninterrupted run.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">piecewise_run_initial</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps <span class="op">=</span> <span class="fl">499</span><span class="op">)</span></span>
<span><span class="va">piecewise_run_final</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps <span class="op">=</span> <span class="fl">1500</span>, state <span class="op">=</span> <span class="va">piecewise_run_initial</span><span class="op">$</span><span class="va">state</span>, restore_random_state <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">piecewise_run</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">piecewise_run_initial</span><span class="op">$</span><span class="va">result</span>, <span class="va">piecewise_run_final</span><span class="op">$</span><span class="va">result</span><span class="op">[</span><span class="fl">500</span><span class="op">:</span><span class="fl">1500</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">uninterrupted_run</span>, <span class="va">piecewise_run</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Component \"S_count\": Mean relative difference: 0.4792393"</span></span>
<span><span class="co">#&gt; [2] "Component \"I_count\": Mean relative difference: 13.31196" </span></span>
<span><span class="co">#&gt; [3] "Component \"R_count\": Mean relative difference: 8.608969"</span></span></code></pre></div>
<p>Using <code>restore_random_state = TRUE</code> resets the global
random number generator’s state, which could have surprising and
undesirable side effects. It is generally useful in tests, but should be
used carefully elsewhere.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps<span class="op">=</span><span class="va">i</span><span class="op">)</span><span class="op">$</span><span class="va">state</span><span class="op">$</span><span class="va">variables</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">run_simulation</span><span class="op">(</span>steps<span class="op">=</span><span class="va">i</span><span class="op">)</span><span class="op">$</span><span class="va">state</span><span class="op">$</span><span class="va">variables</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="kw">break</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] 12</span></span>
<span><span class="co">#&gt; $health</span></span>
<span><span class="co">#&gt; $health$S</span></span>
<span><span class="co">#&gt;   [1]    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15</span></span>
<span><span class="co">#&gt;  [16]   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30</span></span>
<span><span class="co">#&gt;  [31]   31   32   33   34   35   36   37   38   39   40   41   42   43   44   45</span></span>
<span><span class="co">#&gt;  [46]   46   47   48   49   50   51   52   53   54   55   56   57   58   59   60</span></span>
<span><span class="co">#&gt;  [61]   61   62   63   64   65   66   67   68   69   70   71   72   73   74   75</span></span>
<span><span class="co">#&gt;  [76]   76   77   78   79   80   81   82   83   84   85   86   87   89   90   91</span></span>
<span><span class="co">#&gt;  [91]   92   93   95   96   97   98   99  100  101  102  103  104  105  106  107</span></span>
<span><span class="co">#&gt; [106]  108  109  110  111  112  113  114  115  116  117  118  119  120  121  122</span></span>
<span><span class="co">#&gt; [121]  123  124  125  126  127  128  129  130  131  132  133  134  135  136  137</span></span>
<span><span class="co">#&gt; [136]  138  139  140  141  142  143  144  145  146  147  148  149  150  151  152</span></span>
<span><span class="co">#&gt; [151]  153  154  155  156  157  158  159  160  161  162  163  164  165  166  167</span></span>
<span><span class="co">#&gt; [166]  168  169  170  171  172  173  174  175  176  177  178  180  181  182  183</span></span>
<span><span class="co">#&gt; [181]  184  185  186  187  188  189  190  191  192  193  194  196  197  198  199</span></span>
<span><span class="co">#&gt; [196]  200  201  202  203  204  205  206  207  208  209  210  211  212  213  214</span></span>
<span><span class="co">#&gt; [211]  215  216  217  218  219  220  221  222  223  224  225  226  227  228  229</span></span>
<span><span class="co">#&gt; [226]  230  231  232  233  234  235  236  237  238  239  240  241  242  243  244</span></span>
<span><span class="co">#&gt; [241]  245  246  247  248  249  250  251  252  253  254  255  256  257  258  259</span></span>
<span><span class="co">#&gt; [256]  260  261  262  263  264  265  266  267  268  269  270  271  272  273  274</span></span>
<span><span class="co">#&gt; [271]  275  276  277  278  279  280  281  282  283  284  285  286  287  288  289</span></span>
<span><span class="co">#&gt; [286]  290  291  292  293  294  295  296  297  298  299  300  301  302  303  304</span></span>
<span><span class="co">#&gt; [301]  305  306  307  308  309  310  311  312  313  314  315  316  317  318  319</span></span>
<span><span class="co">#&gt; [316]  320  321  322  323  324  325  326  327  328  329  330  331  332  333  334</span></span>
<span><span class="co">#&gt; [331]  335  336  337  338  339  340  341  342  343  344  345  346  347  348  349</span></span>
<span><span class="co">#&gt; [346]  350  351  352  353  354  355  356  357  358  359  360  361  362  363  364</span></span>
<span><span class="co">#&gt; [361]  365  366  367  368  369  370  371  372  373  374  375  376  377  378  379</span></span>
<span><span class="co">#&gt; [376]  380  381  382  383  384  385  386  387  388  389  390  391  392  393  394</span></span>
<span><span class="co">#&gt; [391]  395  396  397  398  399  400  401  402  403  404  405  406  407  408  409</span></span>
<span><span class="co">#&gt; [406]  410  411  412  413  414  416  417  418  419  420  421  422  423  424  425</span></span>
<span><span class="co">#&gt; [421]  426  427  428  429  430  431  432  433  434  435  436  437  438  439  440</span></span>
<span><span class="co">#&gt; [436]  441  442  443  444  445  446  447  448  449  450  451  452  453  454  455</span></span>
<span><span class="co">#&gt; [451]  456  457  458  459  460  461  462  464  465  466  467  468  469  470  471</span></span>
<span><span class="co">#&gt; [466]  472  473  474  475  476  477  478  479  480  481  482  483  484  485  486</span></span>
<span><span class="co">#&gt; [481]  487  488  489  490  491  492  493  494  495  496  497  498  499  500  501</span></span>
<span><span class="co">#&gt; [496]  502  503  504  505  506  507  508  509  510  511  512  513  514  515  516</span></span>
<span><span class="co">#&gt; [511]  517  518  519  520  521  522  523  524  525  527  528  529  530  531  532</span></span>
<span><span class="co">#&gt; [526]  533  534  535  536  537  538  539  540  541  542  543  544  545  546  547</span></span>
<span><span class="co">#&gt; [541]  548  549  550  551  552  553  554  555  556  557  558  559  560  561  562</span></span>
<span><span class="co">#&gt; [556]  563  564  565  566  567  568  569  570  571  572  573  574  575  576  577</span></span>
<span><span class="co">#&gt; [571]  578  579  580  581  582  583  584  585  586  587  588  589  590  591  592</span></span>
<span><span class="co">#&gt; [586]  593  594  595  596  597  598  599  600  601  602  603  604  605  606  607</span></span>
<span><span class="co">#&gt; [601]  608  609  610  611  612  613  614  615  616  617  618  619  620  621  622</span></span>
<span><span class="co">#&gt; [616]  623  624  625  626  627  628  629  630  631  632  633  634  635  636  637</span></span>
<span><span class="co">#&gt; [631]  638  639  640  641  642  643  644  645  646  647  648  649  650  651  652</span></span>
<span><span class="co">#&gt; [646]  653  654  655  656  657  658  659  660  661  662  663  664  665  666  667</span></span>
<span><span class="co">#&gt; [661]  668  669  670  671  672  673  674  675  676  677  678  679  680  681  682</span></span>
<span><span class="co">#&gt; [676]  683  684  685  686  687  688  689  690  691  692  693  694  695  696  697</span></span>
<span><span class="co">#&gt; [691]  698  699  700  701  702  703  704  705  706  707  708  709  710  711  712</span></span>
<span><span class="co">#&gt; [706]  713  714  715  716  717  718  719  720  721  722  723  724  725  726  727</span></span>
<span><span class="co">#&gt; [721]  728  729  730  731  732  733  734  735  736  737  738  739  740  741  742</span></span>
<span><span class="co">#&gt; [736]  743  744  745  746  747  748  749  750  751  752  753  754  755  756  757</span></span>
<span><span class="co">#&gt; [751]  758  759  760  761  762  763  764  765  766  767  768  769  770  771  772</span></span>
<span><span class="co">#&gt; [766]  773  774  775  776  777  778  779  780  781  782  783  784  785  786  787</span></span>
<span><span class="co">#&gt; [781]  788  789  790  791  792  793  794  795  796  797  798  799  800  801  802</span></span>
<span><span class="co">#&gt; [796]  803  804  805  806  807  808  809  810  811  812  813  814  815  816  817</span></span>
<span><span class="co">#&gt; [811]  818  820  821  822  823  824  825  826  827  828  829  830  831  832  833</span></span>
<span><span class="co">#&gt; [826]  834  835  836  837  838  839  840  841  842  843  844  845  846  847  848</span></span>
<span><span class="co">#&gt; [841]  849  850  851  852  853  854  855  856  857  858  859  860  861  862  863</span></span>
<span><span class="co">#&gt; [856]  864  865  866  867  868  869  870  871  872  873  874  875  876  877  878</span></span>
<span><span class="co">#&gt; [871]  879  880  881  882  883  884  885  886  887  888  889  890  891  892  893</span></span>
<span><span class="co">#&gt; [886]  894  895  896  897  898  899  900  901  902  903  904  905  906  907  908</span></span>
<span><span class="co">#&gt; [901]  909  910  911  912  913  914  915  916  917  918  919  920  921  922  923</span></span>
<span><span class="co">#&gt; [916]  924  925  926  927  928  929  930  931  932  933  934  935  936  937  938</span></span>
<span><span class="co">#&gt; [931]  939  940  941  942  943  944  945  946  947  948  949  950  951  952  953</span></span>
<span><span class="co">#&gt; [946]  954  955  956  957  958  959  960  961  962  963  964  965  966  967  968</span></span>
<span><span class="co">#&gt; [961]  969  970  971  972  973  974  975  976  977  978  979  980  981  982  983</span></span>
<span><span class="co">#&gt; [976]  984  985  986  987  988  989  990  991  992  993  994  995  996  997  998</span></span>
<span><span class="co">#&gt; [991]  999 1000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $health$I</span></span>
<span><span class="co">#&gt; [1]  88  94 179 415 463 819</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $health$R</span></span>
<span><span class="co">#&gt; [1] 195 526</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vaccinated</span></span>
<span><span class="co">#&gt; $vaccinated$Y</span></span>
<span><span class="co">#&gt;  [1]  18  21  29  41  47  50  68  69  72  73  83  89  92  95  97 105 106 114 124</span></span>
<span><span class="co">#&gt; [20] 138 141 144 154 185 190 192 210 212 217 230 236 241 257 259 262 274 285 289</span></span>
<span><span class="co">#&gt; [39] 303 306 308 325 329 331 333 359 362 373 374 421 430 447 456 487 501 539 542</span></span>
<span><span class="co">#&gt; [58] 577 607 610 619 620 645 674 677 722 743 745 771 775 787 790 810 818 831 833</span></span>
<span><span class="co">#&gt; [77] 842 854 856 863 872 876 879 881 888 895 915 922 923 934 951 955 956 974 980</span></span>
<span><span class="co">#&gt; [96] 982</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vaccinated$N</span></span>
<span><span class="co">#&gt;   [1]    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15</span></span>
<span><span class="co">#&gt;  [16]   16   17   19   20   22   23   24   25   26   27   28   30   31   32   33</span></span>
<span><span class="co">#&gt;  [31]   34   35   36   37   38   39   40   42   43   44   45   46   48   49   51</span></span>
<span><span class="co">#&gt;  [46]   52   53   54   55   56   57   58   59   60   61   62   63   64   65   66</span></span>
<span><span class="co">#&gt;  [61]   67   70   71   74   75   76   77   78   79   80   81   82   84   85   86</span></span>
<span><span class="co">#&gt;  [76]   87   88   90   91   93   94   96   98   99  100  101  102  103  104  107</span></span>
<span><span class="co">#&gt;  [91]  108  109  110  111  112  113  115  116  117  118  119  120  121  122  123</span></span>
<span><span class="co">#&gt; [106]  125  126  127  128  129  130  131  132  133  134  135  136  137  139  140</span></span>
<span><span class="co">#&gt; [121]  142  143  145  146  147  148  149  150  151  152  153  155  156  157  158</span></span>
<span><span class="co">#&gt; [136]  159  160  161  162  163  164  165  166  167  168  169  170  171  172  173</span></span>
<span><span class="co">#&gt; [151]  174  175  176  177  178  179  180  181  182  183  184  186  187  188  189</span></span>
<span><span class="co">#&gt; [166]  191  193  194  195  196  197  198  199  200  201  202  203  204  205  206</span></span>
<span><span class="co">#&gt; [181]  207  208  209  211  213  214  215  216  218  219  220  221  222  223  224</span></span>
<span><span class="co">#&gt; [196]  225  226  227  228  229  231  232  233  234  235  237  238  239  240  242</span></span>
<span><span class="co">#&gt; [211]  243  244  245  246  247  248  249  250  251  252  253  254  255  256  258</span></span>
<span><span class="co">#&gt; [226]  260  261  263  264  265  266  267  268  269  270  271  272  273  275  276</span></span>
<span><span class="co">#&gt; [241]  277  278  279  280  281  282  283  284  286  287  288  290  291  292  293</span></span>
<span><span class="co">#&gt; [256]  294  295  296  297  298  299  300  301  302  304  305  307  309  310  311</span></span>
<span><span class="co">#&gt; [271]  312  313  314  315  316  317  318  319  320  321  322  323  324  326  327</span></span>
<span><span class="co">#&gt; [286]  328  330  332  334  335  336  337  338  339  340  341  342  343  344  345</span></span>
<span><span class="co">#&gt; [301]  346  347  348  349  350  351  352  353  354  355  356  357  358  360  361</span></span>
<span><span class="co">#&gt; [316]  363  364  365  366  367  368  369  370  371  372  375  376  377  378  379</span></span>
<span><span class="co">#&gt; [331]  380  381  382  383  384  385  386  387  388  389  390  391  392  393  394</span></span>
<span><span class="co">#&gt; [346]  395  396  397  398  399  400  401  402  403  404  405  406  407  408  409</span></span>
<span><span class="co">#&gt; [361]  410  411  412  413  414  415  416  417  418  419  420  422  423  424  425</span></span>
<span><span class="co">#&gt; [376]  426  427  428  429  431  432  433  434  435  436  437  438  439  440  441</span></span>
<span><span class="co">#&gt; [391]  442  443  444  445  446  448  449  450  451  452  453  454  455  457  458</span></span>
<span><span class="co">#&gt; [406]  459  460  461  462  463  464  465  466  467  468  469  470  471  472  473</span></span>
<span><span class="co">#&gt; [421]  474  475  476  477  478  479  480  481  482  483  484  485  486  488  489</span></span>
<span><span class="co">#&gt; [436]  490  491  492  493  494  495  496  497  498  499  500  502  503  504  505</span></span>
<span><span class="co">#&gt; [451]  506  507  508  509  510  511  512  513  514  515  516  517  518  519  520</span></span>
<span><span class="co">#&gt; [466]  521  522  523  524  525  526  527  528  529  530  531  532  533  534  535</span></span>
<span><span class="co">#&gt; [481]  536  537  538  540  541  543  544  545  546  547  548  549  550  551  552</span></span>
<span><span class="co">#&gt; [496]  553  554  555  556  557  558  559  560  561  562  563  564  565  566  567</span></span>
<span><span class="co">#&gt; [511]  568  569  570  571  572  573  574  575  576  578  579  580  581  582  583</span></span>
<span><span class="co">#&gt; [526]  584  585  586  587  588  589  590  591  592  593  594  595  596  597  598</span></span>
<span><span class="co">#&gt; [541]  599  600  601  602  603  604  605  606  608  609  611  612  613  614  615</span></span>
<span><span class="co">#&gt; [556]  616  617  618  621  622  623  624  625  626  627  628  629  630  631  632</span></span>
<span><span class="co">#&gt; [571]  633  634  635  636  637  638  639  640  641  642  643  644  646  647  648</span></span>
<span><span class="co">#&gt; [586]  649  650  651  652  653  654  655  656  657  658  659  660  661  662  663</span></span>
<span><span class="co">#&gt; [601]  664  665  666  667  668  669  670  671  672  673  675  676  678  679  680</span></span>
<span><span class="co">#&gt; [616]  681  682  683  684  685  686  687  688  689  690  691  692  693  694  695</span></span>
<span><span class="co">#&gt; [631]  696  697  698  699  700  701  702  703  704  705  706  707  708  709  710</span></span>
<span><span class="co">#&gt; [646]  711  712  713  714  715  716  717  718  719  720  721  723  724  725  726</span></span>
<span><span class="co">#&gt; [661]  727  728  729  730  731  732  733  734  735  736  737  738  739  740  741</span></span>
<span><span class="co">#&gt; [676]  742  744  746  747  748  749  750  751  752  753  754  755  756  757  758</span></span>
<span><span class="co">#&gt; [691]  759  760  761  762  763  764  765  766  767  768  769  770  772  773  774</span></span>
<span><span class="co">#&gt; [706]  776  777  778  779  780  781  782  783  784  785  786  788  789  791  792</span></span>
<span><span class="co">#&gt; [721]  793  794  795  796  797  798  799  800  801  802  803  804  805  806  807</span></span>
<span><span class="co">#&gt; [736]  808  809  811  812  813  814  815  816  817  819  820  821  822  823  824</span></span>
<span><span class="co">#&gt; [751]  825  826  827  828  829  830  832  834  835  836  837  838  839  840  841</span></span>
<span><span class="co">#&gt; [766]  843  844  845  846  847  848  849  850  851  852  853  855  857  858  859</span></span>
<span><span class="co">#&gt; [781]  860  861  862  864  865  866  867  868  869  870  871  873  874  875  877</span></span>
<span><span class="co">#&gt; [796]  878  880  882  883  884  885  886  887  889  890  891  892  893  894  896</span></span>
<span><span class="co">#&gt; [811]  897  898  899  900  901  902  903  904  905  906  907  908  909  910  911</span></span>
<span><span class="co">#&gt; [826]  912  913  914  916  917  918  919  920  921  924  925  926  927  928  929</span></span>
<span><span class="co">#&gt; [841]  930  931  932  933  935  936  937  938  939  940  941  942  943  944  945</span></span>
<span><span class="co">#&gt; [856]  946  947  948  949  950  952  953  954  957  958  959  960  961  962  963</span></span>
<span><span class="co">#&gt; [871]  964  965  966  967  968  969  970  971  972  973  975  976  977  978  979</span></span>
<span><span class="co">#&gt; [886]  981  983  984  985  986  987  988  989  990  991  992  993  994  995  996</span></span>
<span><span class="co">#&gt; [901]  997  998  999 1000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $health</span></span>
<span><span class="co">#&gt; $health$S</span></span>
<span><span class="co">#&gt;   [1]    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15</span></span>
<span><span class="co">#&gt;  [16]   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30</span></span>
<span><span class="co">#&gt;  [31]   31   32   33   34   35   36   37   38   39   40   41   42   43   44   45</span></span>
<span><span class="co">#&gt;  [46]   46   47   48   49   50   51   52   53   54   55   56   57   58   59   60</span></span>
<span><span class="co">#&gt;  [61]   61   62   63   64   65   66   67   68   69   70   71   72   73   74   75</span></span>
<span><span class="co">#&gt;  [76]   76   77   78   79   80   81   82   83   84   85   86   87   88   89   90</span></span>
<span><span class="co">#&gt;  [91]   91   92   93   94   95   96   97   98   99  100  101  102  103  104  105</span></span>
<span><span class="co">#&gt; [106]  106  107  108  109  110  111  112  113  114  115  116  117  118  119  120</span></span>
<span><span class="co">#&gt; [121]  121  122  123  124  125  126  127  128  129  130  131  132  133  134  135</span></span>
<span><span class="co">#&gt; [136]  136  137  138  139  140  141  142  143  144  145  146  147  148  149  150</span></span>
<span><span class="co">#&gt; [151]  151  152  153  154  155  156  157  158  159  160  161  162  163  164  165</span></span>
<span><span class="co">#&gt; [166]  166  167  168  169  170  171  172  173  174  175  176  177  178  180  181</span></span>
<span><span class="co">#&gt; [181]  182  183  184  185  186  187  188  190  191  192  193  194  196  197  198</span></span>
<span><span class="co">#&gt; [196]  199  200  201  202  203  204  205  206  207  208  209  210  211  212  213</span></span>
<span><span class="co">#&gt; [211]  214  215  216  217  218  219  220  221  222  223  224  225  226  227  228</span></span>
<span><span class="co">#&gt; [226]  229  230  231  232  234  235  236  237  238  239  240  241  242  243  244</span></span>
<span><span class="co">#&gt; [241]  245  246  247  248  249  250  251  252  253  254  255  256  257  258  259</span></span>
<span><span class="co">#&gt; [256]  260  261  262  263  264  265  266  267  268  269  270  271  272  273  274</span></span>
<span><span class="co">#&gt; [271]  275  276  277  278  279  280  281  282  283  284  285  286  287  288  289</span></span>
<span><span class="co">#&gt; [286]  290  291  292  293  294  295  296  297  298  299  300  301  302  303  304</span></span>
<span><span class="co">#&gt; [301]  305  306  307  308  309  311  312  313  314  315  316  317  318  319  320</span></span>
<span><span class="co">#&gt; [316]  321  322  323  324  325  326  327  328  329  330  331  332  333  334  335</span></span>
<span><span class="co">#&gt; [331]  336  337  338  339  340  341  342  343  344  345  346  347  348  349  350</span></span>
<span><span class="co">#&gt; [346]  351  352  353  354  355  356  357  358  359  360  361  362  363  364  365</span></span>
<span><span class="co">#&gt; [361]  366  367  368  369  370  371  372  373  374  375  376  377  378  379  380</span></span>
<span><span class="co">#&gt; [376]  381  382  383  384  386  387  388  389  390  391  392  393  394  395  396</span></span>
<span><span class="co">#&gt; [391]  397  398  399  400  401  402  403  404  405  406  407  408  409  410  411</span></span>
<span><span class="co">#&gt; [406]  412  413  414  416  417  418  419  420  421  422  423  424  425  426  427</span></span>
<span><span class="co">#&gt; [421]  428  429  430  431  432  433  434  435  436  437  438  439  440  441  442</span></span>
<span><span class="co">#&gt; [436]  443  444  445  446  447  448  449  450  451  452  453  454  455  456  457</span></span>
<span><span class="co">#&gt; [451]  458  459  460  461  462  464  465  466  467  468  469  470  471  472  473</span></span>
<span><span class="co">#&gt; [466]  474  475  476  477  478  479  480  481  482  483  484  485  486  487  488</span></span>
<span><span class="co">#&gt; [481]  489  490  491  492  493  494  495  496  497  498  499  500  501  502  503</span></span>
<span><span class="co">#&gt; [496]  504  505  506  507  508  509  510  511  512  513  514  515  516  517  518</span></span>
<span><span class="co">#&gt; [511]  519  520  521  522  523  524  525  527  528  529  530  531  532  533  534</span></span>
<span><span class="co">#&gt; [526]  535  536  537  538  539  540  541  542  543  544  545  546  547  548  549</span></span>
<span><span class="co">#&gt; [541]  550  551  552  553  554  555  556  557  558  559  560  561  562  563  564</span></span>
<span><span class="co">#&gt; [556]  565  566  567  568  569  571  572  573  574  575  576  577  578  579  580</span></span>
<span><span class="co">#&gt; [571]  581  582  583  584  585  586  587  588  589  590  591  592  593  594  595</span></span>
<span><span class="co">#&gt; [586]  596  597  598  599  600  601  602  603  604  605  606  607  608  609  610</span></span>
<span><span class="co">#&gt; [601]  611  612  613  614  615  616  617  618  619  620  621  622  623  624  625</span></span>
<span><span class="co">#&gt; [616]  626  627  628  629  630  631  632  633  634  635  636  637  638  639  640</span></span>
<span><span class="co">#&gt; [631]  641  642  643  644  645  646  647  648  649  650  651  652  653  654  655</span></span>
<span><span class="co">#&gt; [646]  656  657  658  659  660  661  662  664  665  667  668  669  670  671  672</span></span>
<span><span class="co">#&gt; [661]  673  674  675  676  677  678  679  680  681  682  683  684  685  686  687</span></span>
<span><span class="co">#&gt; [676]  688  689  690  691  692  693  694  695  696  697  698  699  700  701  702</span></span>
<span><span class="co">#&gt; [691]  703  704  705  706  707  708  709  710  711  712  713  714  715  716  717</span></span>
<span><span class="co">#&gt; [706]  718  719  720  721  722  723  724  725  726  727  728  729  730  731  732</span></span>
<span><span class="co">#&gt; [721]  733  734  735  736  737  738  739  740  741  742  743  744  745  746  747</span></span>
<span><span class="co">#&gt; [736]  748  749  750  751  752  753  754  755  756  757  758  759  760  761  762</span></span>
<span><span class="co">#&gt; [751]  763  764  765  766  767  768  769  770  771  772  773  774  775  776  777</span></span>
<span><span class="co">#&gt; [766]  778  779  780  781  782  783  784  785  786  787  788  789  790  791  792</span></span>
<span><span class="co">#&gt; [781]  793  794  795  796  797  798  799  800  801  802  803  804  805  806  807</span></span>
<span><span class="co">#&gt; [796]  808  809  810  811  812  813  814  815  816  817  818  819  820  821  822</span></span>
<span><span class="co">#&gt; [811]  823  824  825  826  827  828  829  830  831  832  833  834  835  836  837</span></span>
<span><span class="co">#&gt; [826]  838  839  840  841  842  843  844  845  846  847  848  849  850  851  852</span></span>
<span><span class="co">#&gt; [841]  853  854  855  856  857  858  859  860  861  862  863  864  865  866  867</span></span>
<span><span class="co">#&gt; [856]  868  869  870  871  872  873  874  875  876  877  878  879  880  881  882</span></span>
<span><span class="co">#&gt; [871]  883  884  885  886  887  888  889  890  891  892  893  894  895  896  897</span></span>
<span><span class="co">#&gt; [886]  898  899  900  901  902  903  904  905  906  907  908  909  910  911  912</span></span>
<span><span class="co">#&gt; [901]  913  914  915  916  917  918  919  920  921  922  923  924  925  926  927</span></span>
<span><span class="co">#&gt; [916]  928  929  930  931  932  933  934  935  936  937  938  939  940  941  942</span></span>
<span><span class="co">#&gt; [931]  943  944  945  946  947  948  949  950  951  952  953  954  955  956  957</span></span>
<span><span class="co">#&gt; [946]  958  959  960  961  962  963  964  965  966  967  968  969  970  971  972</span></span>
<span><span class="co">#&gt; [961]  973  974  975  976  977  978  979  980  981  982  983  984  985  986  987</span></span>
<span><span class="co">#&gt; [976]  988  989  990  991  992  993  994  995  996  997  998  999 1000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $health$I</span></span>
<span><span class="co">#&gt; [1] 189 233 385 463 526 570 663 666</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $health$R</span></span>
<span><span class="co">#&gt; [1] 179 195 310 415</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vaccinated</span></span>
<span><span class="co">#&gt; $vaccinated$Y</span></span>
<span><span class="co">#&gt; numeric(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $vaccinated$N</span></span>
<span><span class="co">#&gt;    [1]    1    2    3    4    5    6    7    8    9   10   11   12   13   14</span></span>
<span><span class="co">#&gt;   [15]   15   16   17   18   19   20   21   22   23   24   25   26   27   28</span></span>
<span><span class="co">#&gt;   [29]   29   30   31   32   33   34   35   36   37   38   39   40   41   42</span></span>
<span><span class="co">#&gt;   [43]   43   44   45   46   47   48   49   50   51   52   53   54   55   56</span></span>
<span><span class="co">#&gt;   [57]   57   58   59   60   61   62   63   64   65   66   67   68   69   70</span></span>
<span><span class="co">#&gt;   [71]   71   72   73   74   75   76   77   78   79   80   81   82   83   84</span></span>
<span><span class="co">#&gt;   [85]   85   86   87   88   89   90   91   92   93   94   95   96   97   98</span></span>
<span><span class="co">#&gt;   [99]   99  100  101  102  103  104  105  106  107  108  109  110  111  112</span></span>
<span><span class="co">#&gt;  [113]  113  114  115  116  117  118  119  120  121  122  123  124  125  126</span></span>
<span><span class="co">#&gt;  [127]  127  128  129  130  131  132  133  134  135  136  137  138  139  140</span></span>
<span><span class="co">#&gt;  [141]  141  142  143  144  145  146  147  148  149  150  151  152  153  154</span></span>
<span><span class="co">#&gt;  [155]  155  156  157  158  159  160  161  162  163  164  165  166  167  168</span></span>
<span><span class="co">#&gt;  [169]  169  170  171  172  173  174  175  176  177  178  179  180  181  182</span></span>
<span><span class="co">#&gt;  [183]  183  184  185  186  187  188  189  190  191  192  193  194  195  196</span></span>
<span><span class="co">#&gt;  [197]  197  198  199  200  201  202  203  204  205  206  207  208  209  210</span></span>
<span><span class="co">#&gt;  [211]  211  212  213  214  215  216  217  218  219  220  221  222  223  224</span></span>
<span><span class="co">#&gt;  [225]  225  226  227  228  229  230  231  232  233  234  235  236  237  238</span></span>
<span><span class="co">#&gt;  [239]  239  240  241  242  243  244  245  246  247  248  249  250  251  252</span></span>
<span><span class="co">#&gt;  [253]  253  254  255  256  257  258  259  260  261  262  263  264  265  266</span></span>
<span><span class="co">#&gt;  [267]  267  268  269  270  271  272  273  274  275  276  277  278  279  280</span></span>
<span><span class="co">#&gt;  [281]  281  282  283  284  285  286  287  288  289  290  291  292  293  294</span></span>
<span><span class="co">#&gt;  [295]  295  296  297  298  299  300  301  302  303  304  305  306  307  308</span></span>
<span><span class="co">#&gt;  [309]  309  310  311  312  313  314  315  316  317  318  319  320  321  322</span></span>
<span><span class="co">#&gt;  [323]  323  324  325  326  327  328  329  330  331  332  333  334  335  336</span></span>
<span><span class="co">#&gt;  [337]  337  338  339  340  341  342  343  344  345  346  347  348  349  350</span></span>
<span><span class="co">#&gt;  [351]  351  352  353  354  355  356  357  358  359  360  361  362  363  364</span></span>
<span><span class="co">#&gt;  [365]  365  366  367  368  369  370  371  372  373  374  375  376  377  378</span></span>
<span><span class="co">#&gt;  [379]  379  380  381  382  383  384  385  386  387  388  389  390  391  392</span></span>
<span><span class="co">#&gt;  [393]  393  394  395  396  397  398  399  400  401  402  403  404  405  406</span></span>
<span><span class="co">#&gt;  [407]  407  408  409  410  411  412  413  414  415  416  417  418  419  420</span></span>
<span><span class="co">#&gt;  [421]  421  422  423  424  425  426  427  428  429  430  431  432  433  434</span></span>
<span><span class="co">#&gt;  [435]  435  436  437  438  439  440  441  442  443  444  445  446  447  448</span></span>
<span><span class="co">#&gt;  [449]  449  450  451  452  453  454  455  456  457  458  459  460  461  462</span></span>
<span><span class="co">#&gt;  [463]  463  464  465  466  467  468  469  470  471  472  473  474  475  476</span></span>
<span><span class="co">#&gt;  [477]  477  478  479  480  481  482  483  484  485  486  487  488  489  490</span></span>
<span><span class="co">#&gt;  [491]  491  492  493  494  495  496  497  498  499  500  501  502  503  504</span></span>
<span><span class="co">#&gt;  [505]  505  506  507  508  509  510  511  512  513  514  515  516  517  518</span></span>
<span><span class="co">#&gt;  [519]  519  520  521  522  523  524  525  526  527  528  529  530  531  532</span></span>
<span><span class="co">#&gt;  [533]  533  534  535  536  537  538  539  540  541  542  543  544  545  546</span></span>
<span><span class="co">#&gt;  [547]  547  548  549  550  551  552  553  554  555  556  557  558  559  560</span></span>
<span><span class="co">#&gt;  [561]  561  562  563  564  565  566  567  568  569  570  571  572  573  574</span></span>
<span><span class="co">#&gt;  [575]  575  576  577  578  579  580  581  582  583  584  585  586  587  588</span></span>
<span><span class="co">#&gt;  [589]  589  590  591  592  593  594  595  596  597  598  599  600  601  602</span></span>
<span><span class="co">#&gt;  [603]  603  604  605  606  607  608  609  610  611  612  613  614  615  616</span></span>
<span><span class="co">#&gt;  [617]  617  618  619  620  621  622  623  624  625  626  627  628  629  630</span></span>
<span><span class="co">#&gt;  [631]  631  632  633  634  635  636  637  638  639  640  641  642  643  644</span></span>
<span><span class="co">#&gt;  [645]  645  646  647  648  649  650  651  652  653  654  655  656  657  658</span></span>
<span><span class="co">#&gt;  [659]  659  660  661  662  663  664  665  666  667  668  669  670  671  672</span></span>
<span><span class="co">#&gt;  [673]  673  674  675  676  677  678  679  680  681  682  683  684  685  686</span></span>
<span><span class="co">#&gt;  [687]  687  688  689  690  691  692  693  694  695  696  697  698  699  700</span></span>
<span><span class="co">#&gt;  [701]  701  702  703  704  705  706  707  708  709  710  711  712  713  714</span></span>
<span><span class="co">#&gt;  [715]  715  716  717  718  719  720  721  722  723  724  725  726  727  728</span></span>
<span><span class="co">#&gt;  [729]  729  730  731  732  733  734  735  736  737  738  739  740  741  742</span></span>
<span><span class="co">#&gt;  [743]  743  744  745  746  747  748  749  750  751  752  753  754  755  756</span></span>
<span><span class="co">#&gt;  [757]  757  758  759  760  761  762  763  764  765  766  767  768  769  770</span></span>
<span><span class="co">#&gt;  [771]  771  772  773  774  775  776  777  778  779  780  781  782  783  784</span></span>
<span><span class="co">#&gt;  [785]  785  786  787  788  789  790  791  792  793  794  795  796  797  798</span></span>
<span><span class="co">#&gt;  [799]  799  800  801  802  803  804  805  806  807  808  809  810  811  812</span></span>
<span><span class="co">#&gt;  [813]  813  814  815  816  817  818  819  820  821  822  823  824  825  826</span></span>
<span><span class="co">#&gt;  [827]  827  828  829  830  831  832  833  834  835  836  837  838  839  840</span></span>
<span><span class="co">#&gt;  [841]  841  842  843  844  845  846  847  848  849  850  851  852  853  854</span></span>
<span><span class="co">#&gt;  [855]  855  856  857  858  859  860  861  862  863  864  865  866  867  868</span></span>
<span><span class="co">#&gt;  [869]  869  870  871  872  873  874  875  876  877  878  879  880  881  882</span></span>
<span><span class="co">#&gt;  [883]  883  884  885  886  887  888  889  890  891  892  893  894  895  896</span></span>
<span><span class="co">#&gt;  [897]  897  898  899  900  901  902  903  904  905  906  907  908  909  910</span></span>
<span><span class="co">#&gt;  [911]  911  912  913  914  915  916  917  918  919  920  921  922  923  924</span></span>
<span><span class="co">#&gt;  [925]  925  926  927  928  929  930  931  932  933  934  935  936  937  938</span></span>
<span><span class="co">#&gt;  [939]  939  940  941  942  943  944  945  946  947  948  949  950  951  952</span></span>
<span><span class="co">#&gt;  [953]  953  954  955  956  957  958  959  960  961  962  963  964  965  966</span></span>
<span><span class="co">#&gt;  [967]  967  968  969  970  971  972  973  974  975  976  977  978  979  980</span></span>
<span><span class="co">#&gt;  [981]  981  982  983  984  985  986  987  988  989  990  991  992  993  994</span></span>
<span><span class="co">#&gt;  [995]  995  996  997  998  999 1000</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Giovanni Charles, Sean L. Wu, Peter Winskill, Paul Liétar.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
